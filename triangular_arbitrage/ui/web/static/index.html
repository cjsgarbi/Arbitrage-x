<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbitragem Triangular</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 dark:bg-gray-900">
    <div class="p-6">
        <!-- Header com Métricas -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Arbitragem Triangular</h1>
                <div class="flex items-center gap-4">
                    <div id="exchange-status" class="flex items-center gap-2 text-sm">
                        <svg class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <span class="text-red-500 font-medium">Desconectado</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span id="last-update">Atualizado: --:--:--</span>
                    </div>
                </div>
            </div>

            <!-- Cards de Métricas -->
            <div class="grid grid-cols-4 gap-4">
                <!-- Lucro 24h -->
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow">
                    <div class="p-4">
                        <div class="flex justify-between items-center text-white">
                            <div>
                                <p class="text-sm opacity-90">Lucro 24h</p>
                                <p id="total-profit-24h" class="text-2xl font-bold">$15,840.25</p>
                            </div>
                            <svg class="h-8 w-8 opacity-80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Taxa de Sucesso -->
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow">
                    <div class="p-4">
                        <div class="flex justify-between items-center text-white">
                            <div>
                                <p class="text-sm opacity-90">Taxa de Sucesso</p>
                                <p id="success-rate" class="text-2xl font-bold">94.5%</p>
                            </div>
                            <svg class="h-8 w-8 opacity-80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Slippage Médio -->
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow">
                    <div class="p-4">
                        <div class="flex justify-between items-center text-white">
                            <div>
                                <p class="text-sm opacity-90">Slippage Médio</p>
                                <p id="average-slippage" class="text-2xl font-bold">0.18%</p>
                            </div>
                            <svg class="h-8 w-8 opacity-80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Rotas Ativas -->
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg shadow">
                    <div class="p-4">
                        <div class="flex justify-between items-center text-white">
                            <div>
                                <p class="text-sm opacity-90">Rotas Ativas</p>
                                <p id="active-routes" class="text-2xl font-bold">12</p>
                            </div>
                            <svg class="h-8 w-8 opacity-80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabela Principal de Arbitragem -->
        <div class="shadow-lg mb-6">
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 p-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-white font-bold">Oportunidades de Arbitragem</h2>
                    <span id="routes-badge" class="px-2.5 py-0.5 rounded-full bg-blue-500 text-white">
                        3 Rotas Ativas
                    </span>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="p-3 text-left text-sm font-semibold text-gray-600 dark:text-gray-300">Rota de Arbitragem</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Profit Esperado</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Profit Real</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Slippage</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Tempo Exec.</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Liquidez</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Risco</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Spread</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Volatilidade</th>
                                <th class="p-3 text-center text-sm font-semibold text-gray-600 dark:text-gray-300">Confiança</th>
                            </tr>
                        </thead>
                        <tbody id="arbitrage-pairs-table">
                            <!-- Preenchido dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Operações Recentes -->
        <div class="shadow-lg mb-6">
            <div class="bg-gradient-to-r from-purple-600 to-purple-800 p-6">
                <h2 class="text-white font-bold">Operações Recentes</h2>
            </div>
            <div class="bg-white dark:bg-gray-800 p-4">
                <div id="recent-operations" class="space-y-4">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/static/js/pairs-monitor.js"></script>
    <script>
        // Dados das operações recentes
        const recentOperations = [
            {
                id: 1,
                pairs: ['BTC/USDT', 'ETH/BTC', 'ETH/USDT'],
                profit: 0.025,
                volume24h: 15000000,
                status: 'completed',
                execution: '1.2s',
                timestamp: new Date()
            },
            {
                id: 2,
                pairs: ['BNB/USDT', 'BTC/BNB', 'BTC/USDT'],
                profit: -0.015,
                volume24h: 8000000,
                status: 'error',
                error: 'Insuficiência de liquidez',
                execution: '1.5s',
                timestamp: new Date()
            }
        ];

        // Atualiza operações recentes
        function updateRecentOperations() {
            const container = document.getElementById('recent-operations');
            container.innerHTML = recentOperations.map(op => `
                <div class="rounded border p-4 hover:shadow-md transition-shadow bg-white dark:bg-gray-700">
                    <div class="flex items-start justify-between">
                        <div class="space-y-2">
                            <div class="flex items-center gap-2">
                                <svg class="h-5 w-5 ${op.status === 'completed' ? 'text-green-500' : 'text-red-500'}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${op.status === 'completed' ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'}" />
                                </svg>
                                <span class="font-medium text-white">${op.pairs.join(' → ')}</span>
                            </div>
                            ${op.error ? `<p class="text-sm text-red-500 bg-red-50 dark:bg-red-900 p-2 rounded">${op.error}</p>` : ''}
                            <div class="flex gap-4 text-sm text-gray-400">
                                <span>Volume: $${(op.volume24h / 1000000).toFixed(1)}M</span>
                                <span>Execução: ${op.execution}</span>
                                <span>${op.timestamp.toLocaleTimeString()}</span>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs font-semibold rounded ${
                            op.profit > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${op.profit > 0 ? '+' : ''}${(op.profit * 100).toFixed(3)}%
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // Dados do estado inicial
        const arbitrageData = [
            {
                id: 1,
                route: {
                    step1: { pair: 'BTC/USDT', price: 65420.50, volume: 1250000 },
                    step2: { pair: 'ETH/BTC', price: 0.0562, volume: 890000 },
                    step3: { pair: 'ETH/USDT', price: 3750.80, volume: 950000 }
                },
                expectedProfit: 2.85,
                realizedProfit: 2.65,
                slippage: 0.20,
                executionTime: 1.2,
                liquidity: 'Alta',
                risk: 'Baixo',
                status: 'active',
                spread: 1.8,
                volatility: 'Média',
                confidence: 95
            },
            {
                id: 2,
                route: {
                    step1: { pair: 'ETH/USDT', price: 3755.20, volume: 980000 },
                    step2: { pair: 'BNB/ETH', price: 0.0825, volume: 750000 },
                    step3: { pair: 'BNB/USDT', price: 315.40, volume: 820000 }
                },
                expectedProfit: 2.15,
                realizedProfit: 1.95,
                slippage: 0.20,
                executionTime: 1.4,
                liquidity: 'Média',
                risk: 'Médio',
                status: 'active',
                spread: 1.5,
                volatility: 'Alta',
                confidence: 87
            },
            {
                id: 3,
                route: {
                    step1: { pair: 'SOL/USDT', price: 125.80, volume: 650000 },
                    step2: { pair: 'SOL/BTC', price: 0.00192, volume: 480000 },
                    step3: { pair: 'BTC/USDT', price: 65450.30, volume: 890000 }
                },
                expectedProfit: 1.95,
                realizedProfit: 1.85,
                slippage: 0.10,
                executionTime: 1.1,
                liquidity: 'Média',
                risk: 'Baixo',
                status: 'active',
                spread: 1.2,
                volatility: 'Baixa',
                confidence: 92
            }
        ];

        const metrics = {
            totalProfit24h: 15840.25,
            averageSlippage: 0.18,
            successRate: 94.5,
            activeRoutes: 12
        };

        // Função para criar linha da tabela
        function createArbitrageRow(item) {
            return `
                <tr class="border-b hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td class="p-3">
                        <div class="space-y-1">
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-medium text-white">
                                    ${item.route.step1.pair}
                                </span>
                                <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                                <span class="text-sm font-medium text-white">
                                    ${item.route.step2.pair}
                                </span>
                                <svg class="h-4 w-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                                <span class="text-sm font-medium text-white">
                                    ${item.route.step3.pair}
                                </span>
                            </div>
                        </div>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800">
                            ${item.expectedProfit}%
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 text-xs font-semibold rounded bg-blue-100 text-blue-800">
                            ${item.realizedProfit}%
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="text-orange-600 font-medium">
                            ${item.slippage}%
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="text-gray-600 dark:text-white">
                            ${item.executionTime}s
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 text-xs font-semibold rounded ${
                            item.liquidity === 'Alta' 
                                ? 'bg-green-100 text-green-800'
                                : item.liquidity === 'Média'
                                ? 'bg-yellow-100 text-yellow-800'
                                : 'bg-red-100 text-red-800'
                        }">
                            ${item.liquidity}
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 text-xs font-semibold rounded ${
                            item.risk === 'Baixo'
                                ? 'bg-green-100 text-green-800'
                                : item.risk === 'Médio'
                                ? 'bg-yellow-100 text-yellow-800'
                                : 'bg-red-100 text-red-800'
                        }">
                            ${item.risk}
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="text-gray-600 dark:text-white">
                            ${item.spread}%
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 text-xs font-semibold rounded ${
                            item.volatility === 'Baixa'
                                ? 'bg-green-100 text-green-800'
                                : item.volatility === 'Média'
                                ? 'bg-yellow-100 text-yellow-800'
                                : 'bg-red-100 text-red-800'
                        }">
                            ${item.volatility}
                        </span>
                    </td>
                    <td class="p-3 text-center">
                        <span class="px-2 py-1 text-xs font-semibold rounded ${
                            item.confidence >= 90
                                ? 'bg-green-100 text-green-800'
                                : item.confidence >= 80
                                ? 'bg-yellow-100 text-yellow-800'
                                : 'bg-red-100 text-red-800'
                        }">
                            ${item.confidence}%
                        </span>
                    </td>
                </tr>
            `;
        }

        // Atualiza tabela
        function updateArbitrageTable() {
            const table = document.getElementById('arbitrage-pairs-table');
            table.innerHTML = arbitrageData.map(item => createArbitrageRow(item)).join('');
        }

        // Atualiza métricas
        function updateMetrics() {
            document.getElementById('total-profit-24h').textContent = `$${metrics.totalProfit24h.toLocaleString('pt-BR')}`;
            document.getElementById('success-rate').textContent = `${metrics.successRate}%`;
            document.getElementById('average-slippage').textContent = `${metrics.averageSlippage}%`;
            document.getElementById('active-routes').textContent = metrics.activeRoutes;
            document.getElementById('routes-badge').textContent = `${arbitrageData.length} Rotas Ativas`;
        }

        // Atualiza status da conexão
        let isConnected = false;
        function updateConnectionStatus() {
            const statusEl = document.getElementById('exchange-status');
            if (isConnected) {
                statusEl.innerHTML = `
                    <svg class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-green-500 font-medium">Conectado</span>
                `;
            } else {
                statusEl.innerHTML = `
                    <svg class="h-4 w-4 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <span class="text-red-500 font-medium">Desconectado</span>
                `;
            }
        }

        // Atualiza interface a cada 15 segundos
        setInterval(() => {
            const now = new Date();
            document.getElementById('last-update').textContent = `Atualizado: ${now.toLocaleTimeString()}`;
            updateMetrics();
            updateArbitrageTable();
            updateRecentOperations();
            // Simula alteração do status aleatoriamente (remover em produção)
            isConnected = Math.random() > 0.5;
            updateConnectionStatus();
        }, 15000);

        // Inicialização
        updateMetrics();
        updateArbitrageTable();
        updateRecentOperations();
        updateConnectionStatus();

        // Configura dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
    </script>
</body>
</html>